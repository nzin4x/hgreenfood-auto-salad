# ðŸ” ì½”ë“œ ë¦¬ë·° ë° ê°œì„  ì™„ë£Œ ë³´ê³ ì„œ

## ðŸ“‹ ë°œê²¬ëœ ì£¼ìš” ë²„ê·¸ ë° ë¬¸ì œì 

### 1. âš ï¸ **ë¬´í•œ ë£¨í”„ ë²„ê·¸** (Critical)
**ì›ì¸:**
```python
while True:
    # ... ì˜ˆì•½ ì‹œë„ ...
    logger.info("ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ì´ ë  ë•Œê¹Œì§€ íœ´ì‹ í•©ë‹ˆë‹¤.")
    sleep_until_next_workday_noon(prvdDt, merged_config)  # í•­ìƒ ì‹¤í–‰ë¨!
```
- `main()` í•¨ìˆ˜ì˜ `while True` ë‚´ë¶€ì—ì„œ ì˜ˆì•½ ì„±ê³µ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ í•­ìƒ `sleep_until_next_workday_noon()` í˜¸ì¶œ
- ì²« ì˜ˆì•½ ì„±ê³µ í›„ ë‹¤ì‹œ ë£¨í”„ ì‹œìž‘ ì‹œ, DB ì²´í¬ë¥¼ í†µê³¼í•˜ë”ë¼ë„ ë¡œì§ì´ í˜¼ëž€ìŠ¤ëŸ¬ì›€
- 13ì‹œ ì´ì „ ì‹œìž‘ ì‹œ ì²« ì˜ˆì•½ì€ ì„±ê³µí•˜ì§€ë§Œ, ê·¸ ë‹¤ìŒ ì‚¬ì´í´ì—ì„œ ë¬¸ì œ ë°œìƒ

**í•´ê²°:**
- ìƒíƒœ ê¸°ë°˜ ëª…í™•í•œ ë¶„ê¸° ì²˜ë¦¬
- ì˜ˆì•½ ì™„ë£Œ í›„ í™•ì‹¤í•˜ê²Œ ë‹¤ìŒ ê·¼ë¬´ì¼ê¹Œì§€ ëŒ€ê¸°
- `continue` ë¬¸ìœ¼ë¡œ ë£¨í”„ ì œì–´ ëª…í™•í™”

### 2. ðŸ”„ **ë¶ˆí•„ìš”í•œ ë¡œê·¸ì¸ ë°˜ë³µ** (High)
**ë¬¸ì œ:**
```python
def reserve(merged_config, prvdDt):
    if not ë¡œê·¸ì¸(merged_config):  # ë§¤ë²ˆ ë¡œê·¸ì¸!
        return
```
- ì˜ˆì•½ ì‹œë„ë§ˆë‹¤ ë§¤ë²ˆ ìƒˆë¡œ ë¡œê·¸ì¸
- 5ì´ˆë§ˆë‹¤ ìµœëŒ€ 12íšŒ ìž¬ì‹œë„ ì‹œ â†’ 12ë²ˆ ë¡œê·¸ì¸
- ì„œë²„ ì¸¡ ë´‡ ê°ì§€ ìœ„í—˜ ì¦ê°€

**í•´ê²°:**
- ì „ì—­ `requests.Session()` ê°ì²´ ì‚¬ìš©
- í”„ë¡œê·¸ëž¨ ì‹œìž‘ ì‹œ 1íšŒë§Œ ë¡œê·¸ì¸
- ì¿ í‚¤ íŒŒì¼ ì €ìž¥ ë° ìž¬ì‚¬ìš©
- `login_once` íŒŒë¼ë¯¸í„°ë¡œ ì„¸ì…˜ ìž¬ì‚¬ìš© ì œì–´

### 3. â° **ì‹œê°„ ë¡œì§ ë¶ˆì¼ì¹˜** (Medium)
**ë¬¸ì œ:**
- `holiday.py`ì˜ `ë‹¤ìŒ_ê·¼ë¬´ì¼()`: 13ì‹œ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ëŠ˜/ë‚´ì¼ ê²°ì •
- `main()`ì—ì„œ: ì˜¤ëŠ˜ì´ íœ´ì¼ì¸ì§€ë§Œ ì²´í¬
- 13ì‹œ ì´ì „/ì´í›„ ì²˜ë¦¬ê°€ ì¼ê´€ì„± ì—†ìŒ

**í•´ê²°:**
- `ë‹¤ìŒ_ê·¼ë¬´ì¼()` í•¨ìˆ˜ì—ì„œ 13ì‹œ ê¸°ì¤€ ë¡œì§ í†µí•©
- ë©”ì¸ ë¡œì§ì—ì„œëŠ” ë‹¨ìˆœížˆ ê²°ê³¼ë§Œ ì‚¬ìš©
- ëª…í™•í•œ ì‹œê°„ ë¶„ê¸° ì²˜ë¦¬

### 4. ðŸ“¦ **íŒ¨í‚· ìµœì†Œí™” ë¶€ì¡±** (High)
**ë¬¸ì œ:**
- ì˜ˆì•½ ì‹œê°„ ì „í›„ë¡œ ë¶ˆí•„ìš”í•œ ë°˜ë³µ ì²´í¬
- ë¡œê·¸ì¸ ì¤‘ë³µ
- íœ´ì¼ ë°ì´í„° ë§¤ë²ˆ ì¡°íšŒ

**í•´ê²°:**
- ì˜ˆì•½ ì‹œê°„ ì „í›„ 1ë¶„ ìœˆë„ìš°ë¡œ ì œí•œ
- ìµœëŒ€ ìž¬ì‹œë„ íšŸìˆ˜ ëª…í™•ížˆ ì„¤ì •
- íœ´ì¼ ìºì‹œ ì£¼ê°„ ë‹¨ìœ„ë¡œë§Œ ê°±ì‹ 
- ì„¸ì…˜ ìž¬ì‚¬ìš©

---

## âœ… ê°œì„ ëœ ì½”ë“œ ì£¼ìš” íŠ¹ì§•

### 1. **ì„¸ì…˜ ê´€ë¦¬ ê°œì„ **
```python
# ì „ì—­ ì„¸ì…˜ ê°ì²´ (ë¡œê·¸ì¸ ì„¸ì…˜ ìž¬ì‚¬ìš©)
session = requests.Session()

def ë¡œê·¸ì¸(merged_config, force=False):
    # ì´ë¯¸ ì¿ í‚¤ íŒŒì¼ì´ ìžˆê³  forceê°€ ì•„ë‹ˆë©´ ê¸°ì¡´ ì„¸ì…˜ ì‚¬ìš©
    if not force and os.path.exists('cookies.txt'):
        logger.info("ê¸°ì¡´ ë¡œê·¸ì¸ ì„¸ì…˜ ìž¬ì‚¬ìš©")
        cookies = load_cookies('cookies.txt')
        for name, value in cookies.items():
            session.cookies.set(name, value)
        return True
    # ... ìƒˆë¡œ ë¡œê·¸ì¸
```

### 2. **ëª…í™•í•œ ìƒíƒœ ê¸°ë°˜ ë¡œì§**
```python
while True:
    # 1. ì´ë¯¸ ì˜ˆì•½ ì™„ë£Œ í™•ì¸
    if already_reserved:
        sleep_until_next_workday_noon(prvdDt, merged_config)
        continue
    
    # 2. íœ´ì¼/ì£¼ë§ ì²´í¬
    if today in cached_holidays or now.weekday() >= 5:
        sleep_until_next_workday_noon(prvdDt, merged_config)
        continue
    
    # 3. ì˜ˆì•½ ì‹œê°„ ì²´í¬
    if time_until_reservation > 60:
        # ì˜ˆì•½ ì‹œê°„ê¹Œì§€ ëŒ€ê¸°
        time.sleep(min(time_until_reservation - 60, 3600))
        continue
    
    elif -60 < time_until_reservation <= 60:
        # ì˜ˆì•½ ì‹œë„ (ìµœëŒ€ ìž¬ì‹œë„ íšŸìˆ˜ ì œí•œ)
        # ...
        break
    
    else:
        # ì˜ˆì•½ ì‹œê°„ ì§€ë‚¨
        sleep_until_next_workday_noon(prvdDt, merged_config)
```

### 3. **íŒ¨í‚· ìµœì†Œí™”**
- âœ… ë¡œê·¸ì¸: í”„ë¡œê·¸ëž¨ ì‹œìž‘ ì‹œ 1íšŒë§Œ
- âœ… ì˜ˆì•½ ì‹œë„: 13ì‹œ ì „í›„ 1ë¶„ ë‚´ì—ë§Œ
- âœ… ìµœëŒ€ ìž¬ì‹œë„: ì„¤ì • ê°’ì— ë”°ë¼ ì œí•œ (ê¸°ë³¸ 12íšŒ)
- âœ… íœ´ì¼ API: ì£¼ 1íšŒë§Œ ê°±ì‹ 

### 4. **ì·¨ì†Œ ê¸°ëŠ¥ ì¶”ê°€**
```python
def ì˜ˆì•½ì·¨ì†Œìš”ì²­(prvdDt):
    """ì˜ˆì•½ ì·¨ì†Œ ìš”ì²­"""
    url = "https://hcafe.hgreenfood.com/api/menu/reservation/updateMenuReservationCancel.do"
    # ...
    payload = {
        "prvdDt": prvdDt,
        "reseOrderDate": prvdDt
    }
    response = session.post(url, headers=headers, data=json.dumps(payload), verify=False)
    return response
```

---

## ðŸ“Š ì‹œë‚˜ë¦¬ì˜¤ë³„ ë™ìž‘ íë¦„

### ì‹œë‚˜ë¦¬ì˜¤ 1: 10ì‹œì— í”„ë¡œê·¸ëž¨ ì‹œìž‘
```
10:00 â†’ ë¡œê·¸ì¸ (1íšŒ)
10:00 â†’ ì˜¤ëŠ˜ì´ í‰ì¼ì´ê³  ë¯¸ì˜ˆì•½ í™•ì¸
10:00 â†’ 12:59:50ê¹Œì§€ ì•½ 2ì‹œê°„ 59ë¶„ ëŒ€ê¸°
12:59:50 â†’ ì˜ˆì•½ ì‹œë„ ì‹œìž‘ (5ì´ˆë§ˆë‹¤, ìµœëŒ€ 60ì´ˆ)
13:00:XX â†’ ì˜ˆì•½ ì„±ê³µ!
13:00:XX â†’ ë‹¤ìŒ ê·¼ë¬´ì¼(11/03) 12:59:50ê¹Œì§€ ëŒ€ê¸° (ì•½ 23ì‹œê°„)
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: 14ì‹œì— í”„ë¡œê·¸ëž¨ ì‹œìž‘
```
14:00 â†’ ë¡œê·¸ì¸ (1íšŒ)
14:00 â†’ ë‹¤ìŒ ê·¼ë¬´ì¼ ê³„ì‚° (11/03)
14:00 â†’ DB ì²´í¬: 11/03 ë¯¸ì˜ˆì•½
14:00 â†’ ì˜ˆì•½ ì‹œê°„(13ì‹œ) ì´ë¯¸ ì§€ë‚¨
14:00 â†’ ë‹¤ìŒ ê·¼ë¬´ì¼(11/03) 12:59:50ê¹Œì§€ ëŒ€ê¸° (ì•½ 22ì‹œê°„)
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: 13ì‹œ ì •ê°ì— ì‹œìž‘ + ì´ë¯¸ ì˜ˆì•½ëœ ê²½ìš°
```
13:00 â†’ ë¡œê·¸ì¸ (1íšŒ)
13:00 â†’ DB ì²´í¬: ì˜¤ëŠ˜ ì´ë¯¸ ì˜ˆì•½ë¨
13:00 â†’ ë‹¤ìŒ ê·¼ë¬´ì¼(11/03) 12:59:50ê¹Œì§€ ëŒ€ê¸°
```

### ì‹œë‚˜ë¦¬ì˜¤ 4: ê¸ˆìš”ì¼ ì €ë…
```
ê¸ˆìš”ì¼ 18:00 â†’ ë‹¤ìŒ ê·¼ë¬´ì¼ì€ ì›”ìš”ì¼
18:00 â†’ ì›”ìš”ì¼ 12:59:50ê¹Œì§€ ëŒ€ê¸° (ì•½ 66ì‹œê°„)
```

---

## ðŸ”§ ì„¤ì • íŒŒì¼ ê¶Œìž¥ ì‚¬í•­

### config.user.yaml
```yaml
reserve:
    at: # ì˜ˆì•½ ì‹œìž‘ ì‹œê°„
      hour: 12        # 12ì‹œ (ê¶Œìž¥: 12ì‹œ 59ë¶„ 50ì´ˆë¶€í„° ì‹œìž‘)
      minute: 59
      second: 50
    duration: # ìž¬ì‹œë„ ì„¤ì •
      seconds: 60           # ì´ 60ì´ˆ ë™ì•ˆ ì‹œë„ (13ì‹œ + 1ë¶„ê¹Œì§€)
      sleep_seconds: 5      # 5ì´ˆë§ˆë‹¤ ìž¬ì‹œë„ (ì´ 12íšŒ)
```

**ê¶Œìž¥ ì´ìœ :**
- ì„œë²„ ì‹œê°„ ì°¨ì´ ê³ ë ¤ (Â±5~10ì´ˆ)
- ë„¤íŠ¸ì›Œí¬ ì§€ì—° ê³ ë ¤
- ë„ˆë¬´ ì¼ì° ì‹œìž‘í•˜ë©´ ì˜ˆì•½ ì‹œê°„ ì „ì´ë¼ ì‹¤íŒ¨
- 60ì´ˆ ìœˆë„ìš°ë©´ ì¶©ë¶„ížˆ ìºì¹˜ ê°€ëŠ¥

---

## ðŸ§ª í…ŒìŠ¤íŠ¸ ë„êµ¬

### test_simple.py
ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ (íœ´ì¼ API ì—†ì´ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥)

```bash
# ì˜ˆì•½ í…ŒìŠ¤íŠ¸
python test_simple.py reserve

# ì·¨ì†Œ í…ŒìŠ¤íŠ¸
python test_simple.py cancel

# ì „ì²´ í…ŒìŠ¤íŠ¸ (ì˜ˆì•½ â†’ ì·¨ì†Œ â†’ ìž¬ì˜ˆì•½)
python test_simple.py both
```

---

## ðŸ“ ì¶”ê°€ ê°œì„  ì‚¬í•­

### 1. **ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”**
- ë„¤íŠ¸ì›Œí¬ íƒ€ìž„ì•„ì›ƒ ì¶”ê°€
- ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ ìž¬ì‹œë„ ë¡œì§
- API ì‘ë‹µ ê²€ì¦

### 2. **ë¡œê¹… ê°œì„ **
- ì˜ˆì•½ ì„±ê³µ/ì‹¤íŒ¨ ëª…í™•í•œ ì´ëª¨ì§€ í‘œì‹œ
- ëŒ€ê¸° ì‹œê°„ ì‹œê°„/ë¶„ ë‹¨ìœ„ë¡œ í‘œì‹œ
- ë””ë²„ê·¸ ë ˆë²¨ ë¡œê·¸ ë¶„ë¦¬

### 3. **ì•Œë¦¼ ê¸°ëŠ¥** (ì„ íƒì‚¬í•­)
- ì˜ˆì•½ ì„±ê³µ ì‹œ ì•Œë¦¼ (ì´ë©”ì¼/ìŠ¬ëž™/í…”ë ˆê·¸ëž¨)
- ì˜ˆì•½ ì‹¤íŒ¨ ì‹œ ì•Œë¦¼

---

## ðŸš€ ì‹¤í–‰ ë°©ë²•

### 1. í™˜ê²½ ì„¤ì •
```bash
# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt

# config.user.yaml ìˆ˜ì •
# - userId, userData (ì‹¤ì œ ID/PW)
# - menuSeq (ì„ í˜¸ ë©”ë‰´)
# - data.go.kr API í‚¤ (ì´ë¯¸ ì„¤ì •ë¨)
```

### 2. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
# ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ (íœ´ì¼ API ì—†ì´)
python test_simple.py reserve
```

### 3. ì‹¤ì œ ì‹¤í–‰
```bash
# í”„ë¡œê·¸ëž¨ ì‹¤í–‰ (ë°±ê·¸ë¼ìš´ë“œ)
python app.py

# ë¡œê·¸ í™•ì¸
tail -f app.log
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ë¡œê·¸ì¸ ì •ë³´ ë³´ì•ˆ**
   - `config.user.yaml`ì„ ì ˆëŒ€ ê³µìœ í•˜ì§€ ë§ˆì„¸ìš”
   - `.gitignore`ì— í¬í•¨ë˜ì–´ ìžˆëŠ”ì§€ í™•ì¸

2. **ì„œë²„ ë¶€í•˜**
   - 5ì´ˆ ê°„ê²©, ìµœëŒ€ 12íšŒ ìž¬ì‹œë„ë¡œ ì œí•œë¨
   - ë´‡ ê°ì§€ ìœ„í—˜ ìµœì†Œí™”ë¨

3. **ì‹œê°„ ë™ê¸°í™”**
   - PC ì‹œê°„ì´ ì •í™•í•œì§€ í™•ì¸
   - NTP ë™ê¸°í™” ê¶Œìž¥

4. **ìˆ˜ë©´ ëª¨ë“œ**
   - PCê°€ ìˆ˜ë©´ ëª¨ë“œì— ë“¤ì–´ê°€ë©´ Python í”„ë¡œì„¸ìŠ¤ë„ ë©ˆì¶¤
   - Windows: ì „ì› ì˜µì…˜ì—ì„œ ìˆ˜ë©´ í•´ì œ ì„¤ì •
   - ë˜ëŠ” ìž‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ 12ì‹œ 50ë¶„ì— ê¹¨ìš°ê¸°

---

## ðŸ“ˆ ê°œì„  íš¨ê³¼

| í•­ëª© | ê°œì„  ì „ | ê°œì„  í›„ |
|------|---------|---------|
| ë¡œê·¸ì¸ íšŸìˆ˜ | 12íšŒ/ì¼ | 1íšŒ/ì¼ |
| íŒ¨í‚· ìˆ˜ | ë¬´ì œí•œ | ìµœëŒ€ 13íšŒ/ì¼ (ë¡œê·¸ì¸ 1 + ì˜ˆì•½ 12) |
| ë¬´í•œ ë£¨í”„ ë²„ê·¸ | ìžˆìŒ | í•´ê²° |
| ë´‡ ê°ì§€ ìœ„í—˜ | ë†’ìŒ | ë‚®ìŒ |
| ì•ˆì •ì„± | ë¶ˆì•ˆì • | ì•ˆì •ì  |

---

## âœ… ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] ë¬´í•œ ë£¨í”„ ë²„ê·¸ ìˆ˜ì •
- [x] ë¡œê·¸ì¸ ì„¸ì…˜ ìž¬ì‚¬ìš©
- [x] íŒ¨í‚· ìµœì†Œí™”
- [x] ì·¨ì†Œ ê¸°ëŠ¥ ì¶”ê°€
- [x] í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ìž‘ì„±
- [x] ìƒíƒœ ê¸°ë°˜ ëª…í™•í•œ ë¡œì§
- [x] 13ì‹œ ì´ì „/ì´í›„ ì‹œë‚˜ë¦¬ì˜¤ ì§€ì›
- [x] íœ´ì¼/ì£¼ë§ ìŠ¤í‚µ ë¡œì§
- [x] DB ê¸°ë°˜ ì¤‘ë³µ ì˜ˆì•½ ë°©ì§€
- [x] ë¡œê¹… ê°œì„ 

---

## ðŸŽ¯ ë‹¤ìŒ ë‹¨ê³„

1. **ì‹¤ì œ ID/PWë¡œ í…ŒìŠ¤íŠ¸**
   ```bash
   # config.user.yaml ìˆ˜ì • í›„
   python test_simple.py reserve
   ```

2. **ì˜ˆì•½ ì„±ê³µ í™•ì¸ í›„ ì·¨ì†Œ í…ŒìŠ¤íŠ¸**
   ```bash
   python test_simple.py cancel
   ```

3. **ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œ ì‹¤í–‰**
   ```bash
   python app.py
   ```

4. **ë¡œê·¸ ëª¨ë‹ˆí„°ë§**
   ```bash
   tail -f app.log
   ```

---

**ì½”ë“œ ë¦¬ë·° ì™„ë£Œ! ðŸŽ‰**
